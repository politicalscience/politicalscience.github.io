<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Unsupervised Learning Methods – Political Science &amp; Political Economy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="mathjax-config.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./model4.html">Unsupervised Learning Methods</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Kevin’s PSPE Resources</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
 <span class="menu-text">Quantitative Methods (Causal Inference)</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 Introductory Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 Multiple Linear Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 Classical Least Squares Theory</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4 Causal Frameworks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 Randomised Controlled Trials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6 Selection on Observables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant7.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7 Instrumental Variables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant8.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8 Regression Discontinuity</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quant9.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9 Differences-in-Differences</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
 <span class="menu-text">Other Materials</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./games.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide to Game Theory</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Algebra Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calc.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calculus Reference</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
 <span class="menu-text">More Statistical Models</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model1.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistic Regression Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model2.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression for Counts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supervised Learning Methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Unsupervised Learning Methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Factor Analysis Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model6.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Latent Trait Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model7.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Latent Class Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model9.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structural Equation Models</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On This Page</h2>
   
  <ul>
  <li><a href="#principle-components-analysis" id="toc-principle-components-analysis" class="nav-link active" data-scroll-target="#principle-components-analysis"><strong>Principle Components Analysis</strong></a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#observed-variables" id="toc-observed-variables" class="nav-link" data-scroll-target="#observed-variables">Observed Variables</a></li>
  <li><a href="#principle-components" id="toc-principle-components" class="nav-link" data-scroll-target="#principle-components">Principle Components</a></li>
  <li><a href="#calculating-principle-components" id="toc-calculating-principle-components" class="nav-link" data-scroll-target="#calculating-principle-components">Calculating Principle Components</a></li>
  <li><a href="#standardisation-of-items" id="toc-standardisation-of-items" class="nav-link" data-scroll-target="#standardisation-of-items">Standardisation of Items</a></li>
  </ul></li>
  <li><a href="#interpreting-principle-components" id="toc-interpreting-principle-components" class="nav-link" data-scroll-target="#interpreting-principle-components"><strong>Interpreting Principle Components</strong></a>
  <ul class="collapse">
  <li><a href="#choosing-number-of-components" id="toc-choosing-number-of-components" class="nav-link" data-scroll-target="#choosing-number-of-components">Choosing Number of Components</a></li>
  <li><a href="#weights-and-component-loadings" id="toc-weights-and-component-loadings" class="nav-link" data-scroll-target="#weights-and-component-loadings">Weights and Component Loadings</a></li>
  <li><a href="#weights-and-correlations-of-original-variables" id="toc-weights-and-correlations-of-original-variables" class="nav-link" data-scroll-target="#weights-and-correlations-of-original-variables">Weights and Correlations of Original Variables</a></li>
  <li><a href="#principle-component-scores" id="toc-principle-component-scores" class="nav-link" data-scroll-target="#principle-component-scores">Principle Component Scores</a></li>
  </ul></li>
  <li><a href="#cluster-analysis" id="toc-cluster-analysis" class="nav-link" data-scroll-target="#cluster-analysis"><strong>Cluster Analysis</strong></a></li>
  <li><a href="#implementation-in-r" id="toc-implementation-in-r" class="nav-link" data-scroll-target="#implementation-in-r"><strong>Implementation in R</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Unsupervised Learning Methods</h1>
<p class="subtitle lead">Further Statistical Models</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This chapter introduces unsupervised learning methods commonly used in Data Science. First, we will discuss Principle Components Analysis, a popular dimensional reduction approach. Then, we will discuss cluster analysis, a popular method of learning more about our data.</p>
<p>Use the right sidebar for navigation. R-code provided at the bottom.</p>
<hr>
<section id="principle-components-analysis" class="level1">
<h1><strong>Principle Components Analysis</strong></h1>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>Principle Components Analysis (PCA) combines multiple observed variables into one or new observed variables (called <strong>principle components</strong>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3381986820.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: Trust in Institutions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A survey asked respondents to respond, on a scale of 0-10, how much they trust the institutions.</p>
<ul>
<li>Parliament: <span class="math inline">\(x_1\)</span></li>
<li>Legal: <span class="math inline">\(x_2\)</span></li>
<li>Police: <span class="math inline">\(x_3\)</span></li>
<li>Politicians: <span class="math inline">\(x_4\)</span></li>
<li>Political Parties: <span class="math inline">\(x_5\)</span></li>
<li>European Parliament: <span class="math inline">\(x_6\)</span></li>
<li>United Nations: <span class="math inline">\(x_7\)</span></li>
</ul>
<p>We don’t care about each variable individually. We want to summarise them into one variable that describes trust in institutions.</p>
<p>We can use PCA to create <span class="math inline">\(y_1\)</span> (and <span class="math inline">\(y_2\)</span>, and more).</p>
</div>
</div>
</div>
<p>PCA can be used for dimensional reduction (reducing the number of variables), or for summarising multiple variables into one measure.</p>
<p><br></p>
</section>
<section id="observed-variables" class="level3">
<h3 class="anchored" data-anchor-id="observed-variables">Observed Variables</h3>
<p>We have <span class="math inline">\(p\)</span> observed variables <span class="math inline">\(x_1, \dots, x_p\)</span>, measured for each unit in a sample of data.</p>
<p>Each of these observered variables <span class="math inline">\(x_i\)</span> can be summarised by:</p>
<ol type="1">
<li>Their sample means <span class="math inline">\(\bar x_i\)</span>.</li>
<li>Their sample variances <span class="math inline">\(var(x_i)\)</span> and standard deviations <span class="math inline">\(s_i = \sqrt{Var(x_i)}\)</span>.</li>
<li>Sample correlations <span class="math inline">\(Corr(x_i, x_k)\)</span> for each pair of observed variables <span class="math inline">\(i ≠ k\)</span>.</li>
<li>Total variance of the <span class="math inline">\(p\)</span> variables: <span class="math inline">\(Var(x_1) + Var(x_2)+ \dots + Var(x_p)\)</span>.</li>
</ol>
<p>The sample correlations <span class="math inline">\(Corr(x_i, x_k)\)</span> can be summarised in a covariance or correlation matrix. We notate the covariance or correlation matrix as <span class="math inline">\(\boldsymbol\Sigma\)</span>.</p>
<p>Below is an example of a correlation matrix between 7 variables (the same 7 in the example above).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-1213137255.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
<p><br></p>
</section>
<section id="principle-components" class="level3">
<h3 class="anchored" data-anchor-id="principle-components">Principle Components</h3>
<p>PCA takes these original variables <span class="math inline">\(x_1, \dots, x_p\)</span>, and calculates a set of new variables (principle components) <span class="math inline">\(y_1, \dots, y_p\)</span>. Each principle component <span class="math inline">\(y_j\)</span> are linear combinations of the original variables:</p>
<p><span class="math display">\[
\begin{split}
y_1 = &amp; a_{11}x_1 + a_{21}x_2 + \dots + a_{p1}x_p \\
y_2 = &amp; a_{12}x_1 + a_{22}x_2 + \dots + a_{p2}x_p \\
&amp; \vdots \\
y_p = &amp; a_{1p}x_1 + a_{2p}x_2 + \dots + a_{pp}x_p
\end{split}
\]</span></p>
<p>With <span class="math inline">\(a_{ij}\)</span> being the weights of the linear combinations. The sum of all the weights for each principle component should be 1: <span class="math inline">\(\sum_i a_{ij}^2 = 1\)</span> for each <span class="math inline">\(j = 1, 2, \dots, p\)</span>.</p>
<p>We can rewrite each principle component <span class="math inline">\(y_j\)</span> in terms of linear algebra:</p>
<p><span class="math display">\[
y_j = \mathbf a_j^\mathsf{T}\mathbf x = \underbrace{\begin{pmatrix}
a_{1j} &amp; a_{2j} &amp;\dots &amp; a_{pj}
\end{pmatrix}}_{\text{weight vector for } y_i} \begin{pmatrix}
x_1 \\ x_2 \\ \vdots \\ x_p
\end{pmatrix}
\]</span></p>
<p>And all principle components <span class="math inline">\(\mathbf y = (y_1, \dots, y_p)\)</span> can be expressed as:</p>
<p><span class="math display">\[
\mathbf y = \mathbf A^\mathsf{T} \mathbf x, \quad \mathbf A = \begin{pmatrix} \mathbf a_1 &amp; \mathbf a_2 &amp; \dots &amp; \mathbf a_p \end{pmatrix}
\]</span></p>
<p>The PCs together have the same total variance as the original variables: <span class="math inline">\(\sum Var(y_i) = \sum Var(x_i)\)</span>. Thus, the PCs carry the same information/variation as the original variables, just with a different distribution. The principle components are also numbered, with each subsequent principle component having less variance: <span class="math inline">\(Var(y_j) ≥ Var(y_{j+1})\)</span>.</p>
<p>The principle components are all uncorrelated with each other: <span class="math inline">\(Corr(y_j , y_k) = 0, \ \forall \ j ≠ k\)</span>. This also implies a property with weights: <span class="math inline">\(\sum_i a_{ij}a_{ik} = 0\)</span> for every pair <span class="math inline">\(j ≠ k\)</span>. Thus, the difference components convey distinct aspects of the data.</p>
<p><br></p>
</section>
<section id="calculating-principle-components" class="level3">
<h3 class="anchored" data-anchor-id="calculating-principle-components">Calculating Principle Components</h3>
<p>The weights <span class="math inline">\(a_{ij}\)</span> are calculated from <a href="./linear.html#eigenvector-decomposition">eigenvalue decomposition</a> of the covariance matrix <span class="math inline">\(\boldsymbol\Sigma\)</span> of variables <span class="math inline">\(x_1, \dots, x_p\)</span>.</p>
<p>We assume that <span class="math inline">\(\boldsymbol\Sigma\)</span> has <span class="math inline">\(p\)</span> distinct positive eigenvalues, denoted <span class="math inline">\(\lambda_1 &gt; \dots, \lambda_p &gt; 0\)</span>. Each eigenvalue corresponds to a eigenvector <span class="math inline">\(\mathbf a_j\)</span>, which serves as the weight vector for the <span class="math inline">\(i\)</span>th principle component:</p>
<p><span class="math display">\[
\boldsymbol\Sigma \mathbf a_j = \lambda_j \mathbf a_j
\]</span></p>
<p>We can apply eigenvalue decomposition to matrix <span class="math inline">\(\boldsymbol\Sigma\)</span>:</p>
<p><span class="math display">\[
\boldsymbol\Sigma = \mathbf{ADA}^{-1}
\]</span></p>
<p>Where <span class="math inline">\(\mathbf Q\)</span> is made up of the eigenvectors of matrix <span class="math inline">\(\boldsymbol\Sigma\)</span>, and <span class="math inline">\(\mathbf D\)</span> is a diagonal matrix with the eigenvalues <span class="math inline">\(\lambda\)</span> on its diagonals:</p>
<p><span class="math display">\[
\mathbf D = \begin{pmatrix}
\lambda_1 &amp; 0 &amp; \dots &amp; 0 \\
0 &amp; \lambda_2 &amp; \dots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; 0 &amp; \lambda_p
\end{pmatrix}, \quad \mathbf A = \begin{pmatrix} \mathbf a_1 &amp; \mathbf a_2 &amp; \dots &amp; \mathbf a_p \end{pmatrix}
\]</span></p>
<p>The principle components will be as follows:</p>
<p><span class="math display">\[
\mathbf y = \mathbf A^\mathsf{T} \mathbf x
\]</span></p>
<p><br></p>
</section>
<section id="standardisation-of-items" class="level3">
<h3 class="anchored" data-anchor-id="standardisation-of-items">Standardisation of Items</h3>
<p>The results of PCA will be affected by the variances of individual variables. If <span class="math inline">\(Var(x_1) &gt; Var(x_2)\)</span>, <span class="math inline">\(x_1\)</span> will receive a larger weight in PCA.</p>
<p>This means that if we have different measurement scales for variables, we can get very different PCA results. This is very similar to the issue of comparing covariances, which generally need to be standardised into correlation coefficients.</p>
<p>To prevent measurement scales from affecting PCA, we will standardise the observations for each variable, creating a new variable <span class="math inline">\(z_{it}\)</span> (<span class="math inline">\(t\)</span> is observations <span class="math inline">\(t = 1, \dots, n\)</span> in the sample):</p>
<p><span class="math display">\[
z_{it} = \frac{x_{it} - \bar x_i}{s_i}
\]</span></p>
<p>A standardised variable has sample mean 0, and standard deviation and variance of 1. Thus, the total variance of all standardised variables <span class="math inline">\(z_i\)</span> is equal to the number of variables:</p>
<p><span class="math display">\[
\sum\limits_{i=1}^p Var(z_i) = p
\]</span></p>
<p>We can also avoid the standardisation step by performing PCA on the correlation matrix instead of the covariance matrix (since correlation coefficients are already standardised).</p>
<p><br></p>
<p><br></p>
<hr>
</section>
</section>
<section id="interpreting-principle-components" class="level1">
<h1><strong>Interpreting Principle Components</strong></h1>
<section id="choosing-number-of-components" class="level3">
<h3 class="anchored" data-anchor-id="choosing-number-of-components">Choosing Number of Components</h3>
<p>The variance of <span class="math inline">\(y_j\)</span>, is equivalent to the <span class="math inline">\(j\)</span>th eigenvalue: <span class="math inline">\(Var(y_j) = \lambda_j\)</span>. Principle components are listed in decreasing order of variance <span class="math inline">\(\lambda_1, ≥ \lambda_2 ≥ \dots ≥ \lambda_p\)</span>. The proportion of the first <span class="math inline">\(q\)</span> principle components is thus:</p>
<p><span class="math display">\[
\frac{\lambda_1 + \lambda_2 + \dots + \lambda_q}{\lambda_1 + \lambda_2 + \dots + \lambda_p}
\]</span></p>
<p>You could just choose the first principle component <span class="math inline">\(y_1\)</span>, and use it. However, the best practice is to retain as few as possible principle components, without losing a significant amount of variability. There are a few different rules that people often use to determine how many principle components to use:</p>
<ol type="1">
<li>Retain as many components <span class="math inline">\(q\)</span> such that it explains 70-80% of the variation.</li>
<li>Retain components with large eigenvalues <span class="math inline">\(\lambda_j\)</span>, generally at least 0.7 if using the covariance matrix, and 1 for the correlation matrix.</li>
<li>Omit components once <span class="math inline">\(\lambda_j\)</span> stops decreasing significantly (using a scree plot).</li>
</ol>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Scree Plot of <span class="math inline">\(\lambda_j\)</span>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Below is a scree plot of <span class="math inline">\(\lambda_j\)</span> on the <span class="math inline">\(y\)</span> axis, and the principle component on the <span class="math inline">\(y\)</span> axis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-433752634.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:65.0%"></p>
</figure>
</div>
<p>We can see after the first two principle components, the plot becomes relatively flat. Thus, we can keep components 1 and 2, and we can ignore the rest.</p>
</div>
</div>
</div>
<p>Generally, you will normally keep around 2 or 3 principle components following these guidelines. You should also consider the interpretation of the principle components when deciding to keep the components.</p>
<p><br></p>
</section>
<section id="weights-and-component-loadings" class="level3">
<h3 class="anchored" data-anchor-id="weights-and-component-loadings">Weights and Component Loadings</h3>
<p>Each principle component is a weighted sum of the original variables, with <span class="math inline">\(a_{ij}\)</span> being weights:</p>
<p><span class="math display">\[
y_j = a_{1j}x_1 + a_{2j}x_2 + \dots + a_{pj}x_p
\]</span></p>
<p>Thus, a larger weight for a variable means that variable contributes more, and a smaller weight for a variable means that the variable contributes less.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example of Interpreting Weights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Below is a table of weights:</p>
<p><img src="images/clipboard-2989123362.png" class="img-fluid" style="width:100.0%"></p>
<p>We can see that it seems that police is contributing the least to the first principle component <span class="math inline">\(y_1\)</span>.</p>
</div>
</div>
</div>
<p>We can also consider the weights in a normalised form, called <strong>component loadings</strong>:</p>
<p><span class="math display">\[
a^*_{ij} = \sqrt{\lambda_j}  \ a_{ij} = sd(y_j) a_{ij}
\]</span></p>
<p>When PCA is based on the correlation matrix, we will have the property that the component loadings equals the correlation between the given variable <span class="math inline">\(x_i\)</span> and the principle component <span class="math inline">\(y_j\)</span>:</p>
<p><span class="math display">\[
a^*_{ij} = Corr(x_i, y_j)
\]</span></p>
<p>This property can help us interpret what higher values of <span class="math inline">\(y_j\)</span> and lower values of <span class="math inline">\(y_j\)</span> mean for each principle component.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example of Component Weights
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Below is a table of component weights:</p>
<p><img src="images/clipboard-2059086054.png" class="img-fluid" style="width:100.0%"></p>
<p>We can see that all of the component weights for the first component are positive. That means that the first principle component <span class="math inline">\(y_1\)</span> is positively correlated with all <span class="math inline">\(x_i\)</span>.</p>
<p>We know that all <span class="math inline">\(x_i\)</span> are scales of 0 - 10 on how much they trust the institution in question. Thus, we know that for principle component <span class="math inline">\(y_1\)</span>, that higher values mean higher trust in institutions.</p>
<p>For the second principle component <span class="math inline">\(y_2\)</span>, there are some positives and some negatives. The negative correlations are with legal, police, and UN, and the positive correlations are with parliament, politicians, political parties, and european parliament.</p>
<p>We could interpret this as the second principle component <span class="math inline">\(y_2\)</span> increases, the trust in legal/police decreases, but the trust in political institutions increase. Thus, <span class="math inline">\(y_2\)</span> could be a measure of trust in legal/police versus political institutions.</p>
<p>For the third principle component, we can see only the trust in european parliament and UN is negative. Thus, we could interpret <span class="math inline">\(y_2\)</span> as a measure of trust in national versus international institutions.</p>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="weights-and-correlations-of-original-variables" class="level3">
<h3 class="anchored" data-anchor-id="weights-and-correlations-of-original-variables">Weights and Correlations of Original Variables</h3>
<p>PCA is derived from the sample correlation matrix. Thus, the weights also reflect patterns in the correlations of the original variables <span class="math inline">\(x_i\)</span>.</p>
<p>Patterns between the weights of the first principle component and correlation matrix include the following:</p>
<ul>
<li>If the correlations of all variables is positive, then the first principle component will be positive. This is because all the variables that are correlated mean they are measuring the “same thing” in the same direction.</li>
<li>Variables which on average have the largest correlations with other variables will get the largest weights. This makes sense, since variables with the largest correlations seem to be measuring the “concept” the most.</li>
<li>If a variable has 0 correlation with the other variables, it will get a 0 weight, since it is measuring a completely different thing than the other variables.</li>
</ul>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correlation Matrix and the First Principle Component
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Below is a correlation matrix between variables:</p>
<p><img src="images/clipboard-3732715283.png" class="img-fluid"></p>
<p>We can see the variable <em>politicians</em> (highlighted in blue) have the largest correlation with the other variables on average.</p>
<p>We can see the variable <em>police</em> (highlighted in yellow) have the smallest correlation with other variables on average. It might be the “odd one out”, not as lined up as the rest, so it gets a smaller weight in the first principle component.</p>
</div>
</div>
</div>
<p>The second principle component is the <em>contrast</em> of the first principle component (remember, the covariance between the two is 0).</p>
<p>It will identify two subgroups of variables, such that each subgroup will have high correlations within them, but the correlation between groups is lower.</p>
<p><br></p>
</section>
<section id="principle-component-scores" class="level3">
<h3 class="anchored" data-anchor-id="principle-component-scores">Principle Component Scores</h3>
<p>For each unit <span class="math inline">\(i\)</span> (individual), we can calculate a component score for the <span class="math inline">\(j\)</span>th principle component:</p>
<p><span class="math display">\[
y_j = a_{1j}z_1 + a_{2j}z_2 + \dots + a_{pj}z_p
\]</span></p>
<p>By doing this for each individual unit <span class="math inline">\(i\)</span>, we now have a new variable <span class="math inline">\(y_j\)</span> that we can use for further analysis. Such analyses can include:</p>
<ol type="1">
<li>We could plot the principle component scores for the first and second principle component score, and look for clusters with similar values.</li>
<li>We could use the principle component scores as summary statistics for some phenomena.</li>
<li>We could also use the scores of <span class="math inline">\(y_j\)</span> and input into a regression model or another statistical model.</li>
</ol>
<p><br></p>
<p><br></p>
<hr>
</section>
</section>
<section id="cluster-analysis" class="level1">
<h1><strong>Cluster Analysis</strong></h1>
<p><br></p>
<hr>
</section>
<section id="implementation-in-r" class="level1">
<h1><strong>Implementation in R</strong></h1>
<p>You will need packages <em>psych</em> and <em>GPArotation</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GPArotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To estimate the principle components, you should use the <em>princomp()</em> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pca_object <span class="ot">&lt;-</span> <span class="fu">princomp</span>(<span class="sc">~</span>x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> mydata,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cor =</span> <span class="cn">TRUE</span>, <span class="co">#to do on corr matrix</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scores =</span> <span class="cn">TRUE</span>, <span class="co">#calculate scores</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.action =</span> na.exclude)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(newObject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The summary command will provide the standard deviation of each principle component, the proportion of total variance each component explains, and the cumulative proportion of variance explained.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Obtaining Variances/Eigenvalues
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The variances of each principle component (also the eigenvalues) are the square of the standard deviation. We can obtain as following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pca_object<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Screeplot
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To create a screeplot to help identify how many principle components to keep, we use the <em>screeplot()</em> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(pca_object, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">main=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Weights and Component Loadings
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can calculate weights for each principle component by using the <em>loadings()</em> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pca_weights <span class="ot">&lt;-</span> <span class="fu">loadings</span>(pca_object)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pca_loadings, <span class="at">cutoff =</span> <span class="dv">0</span>, <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For component loadings (weights in a normalised form), we first get the square root of the eigenvalues <span class="math inline">\(\lambda_i\)</span>, then we multiply our weights with those square roots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sqrt_lambda <span class="ot">&lt;-</span> pca_object<span class="sc">$</span>sdev</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">t</span>(<span class="fu">t</span>(pca_weights)<span class="sc">*</span>sqrt_lambda), <span class="at">cutoff =</span> <span class="dv">0</span>, <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Component Scores
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can access component scores in the <em>pca_object</em> we originally created:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pca_object<span class="sc">$</span>score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will give you a table, with the rows being different units in the data, and the columns being different principle component scores for each principle component.</p>
<p>If you are wanting to just view the scores, it is recommended to subset the data if you have too many observations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pca_object<span class="sc">$</span>score[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,] <span class="co">#first 10 units</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also subset the number of principle components:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pca_object<span class="sc">$</span>score[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="co">#first 3 PC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
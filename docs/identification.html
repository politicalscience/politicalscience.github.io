<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Causal Identification – Statistics for Political Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<link href="./soo.html" rel="next">
<link href="./mom.html" rel="prev">
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="mathjax-config.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./random.html">Part I: Statistical Theory</a></li><li class="breadcrumb-item"><a href="./identification.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Causal Identification</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics for Political Science</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Statistical Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistical Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classical Least Squares</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Generalised Least Squares</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Maximum Likelihood</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Method of Moments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./identification.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Causal Identification</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Applied Causal Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./soo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Selection on Observables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Instrumental Variables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#potential-outcomes-framework" id="toc-potential-outcomes-framework" class="nav-link active" data-scroll-target="#potential-outcomes-framework"><span class="header-section-number">7.1</span> Potential Outcomes Framework</a></li>
  <li><a href="#causal-estimands" id="toc-causal-estimands" class="nav-link" data-scroll-target="#causal-estimands"><span class="header-section-number">7.2</span> Causal Estimands</a></li>
  <li><a href="#structural-causal-models" id="toc-structural-causal-models" class="nav-link" data-scroll-target="#structural-causal-models"><span class="header-section-number">7.3</span> Structural Causal Models</a></li>
  <li><a href="#selection-bias" id="toc-selection-bias" class="nav-link" data-scroll-target="#selection-bias"><span class="header-section-number">7.4</span> Selection Bias</a></li>
  <li><a href="#confounders" id="toc-confounders" class="nav-link" data-scroll-target="#confounders"><span class="header-section-number">7.5</span> Confounders</a></li>
  <li><a href="#randomisation" id="toc-randomisation" class="nav-link" data-scroll-target="#randomisation"><span class="header-section-number">7.6</span> Randomisation</a></li>
  <li><a href="#randomised-experiments" id="toc-randomised-experiments" class="nav-link" data-scroll-target="#randomised-experiments"><span class="header-section-number">7.7</span> Randomised Experiments</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./random.html">Part I: Statistical Theory</a></li><li class="breadcrumb-item"><a href="./identification.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Causal Identification</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Causal Identification</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>So far, we have introduced multiple estimators to help estimate parameters that describe the relationships between variables.</p>
<p>In this chapter, our goal is to go from relationships/correlation to causation. First, we introduce the popular causal frameworks and causal estimands. Then, we discuss the issue with selection bias, and why correlation is not causation. Finally, we finish by discussing a few popular methods of theoretically identifying causal effects. For the implementation of these methods, see the chapter on causal designs.</p>
<p><br></p>
<section id="potential-outcomes-framework" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="potential-outcomes-framework"><span class="header-section-number">7.1</span> Potential Outcomes Framework</h2>
<p>A lot of social science and science is about understanding the causes of things. This involves understanding how some treatment variable <span class="math inline">\(D\)</span> causes some outcome variable <span class="math inline">\(Y\)</span>. We call our treatment variable <span class="math inline">\(D\)</span>. For each unit <span class="math inline">\(i\)</span>, they have a treatment status of <span class="math inline">\(D_i\)</span>:</p>
<p><span class="math display">\[
D_i = \begin{cases}
1 &amp; \text{if unit i received the treatment} \\
0 &amp; \text{if unit i did not receive the treatment}
\end{cases}
\]</span></p>
<p>Now, imagine that there are two parallel worlds. In one of these parallel worlds, unit <span class="math inline">\(i\)</span> receives the treatment <span class="math inline">\(D_i = 1\)</span>. In the other parallel world, unit <span class="math inline">\(i\)</span> does not receive the treatment <span class="math inline">\(D_i = 0\)</span>. Everything about these two parallel worlds besides <span class="math inline">\(D_i\)</span> is identical. The outcome <span class="math inline">\(Y\)</span> value in these two worlds is called the potential outcomes.</p>
<div id="def-potoutcomes" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.1 (Potential Outcomes)</strong></span> The potential outcomes <span class="math inline">\(Y_{di}\)</span> or <span class="math inline">\(Y_i(d)\)</span> for unit <span class="math inline">\(i\)</span> are the <span class="math inline">\(Y\)</span> values in the two identical parallel worlds besides the <span class="math inline">\(D_i\)</span> value.</p>
<p><span class="math display">\[
Y_{di}, Y_i(d) = \begin{cases}
Y_{1i}, Y_i(1) &amp; D_i = 1\text{ parallel world outcome Y value for unit i} \\
Y_{0i}, Y_i(0) &amp; D_i = 0\text{ parallel world outcome Y value for unit i} \\
\end{cases}
\]</span></p>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stable Unit Treatment Value Assumption
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The above mentioned potential outcomes framework depends on the stablue unit treatment value assumption (SUTVA).</p>
<p>It basically says that unit <span class="math inline">\(i\)</span>’s potential outcomes <span class="math inline">\(Y_{1i}\)</span> and <span class="math inline">\(Y_{0i}\)</span> are not affected in any way by unit <span class="math inline">\(j\)</span>’s treatment status <span class="math inline">\(D_j\)</span>. Basically, changing other individual’s treatment status has no effect on an individual’s own outcomes.</p>
<p>If SUTVA is violated, then our nice two parallel worlds example no longer is accurate. This is because if SUTVA is violated, unit <span class="math inline">\(i\)</span> now has the potential outcomes of themselves receiving <span class="math inline">\(D_i = 1, 0\)</span>, but also other people <span class="math inline">\(D_j = 0, 1\)</span>. This will make the number of outcomes grow massively (especially if multiply other units affect an individual).</p>
<p>Common causes of SUTVA violations include:</p>
<ul>
<li>Spill-over effects: If we are testing a new curriculum, one student <span class="math inline">\(j\)</span> getting the new curriculum may teach their friend <span class="math inline">\(i\)</span> the new curriculum, which means if student <span class="math inline">\(j\)</span> got or did not get the new curriculum would affect student <span class="math inline">\(i\)</span>’s outcomes.</li>
<li>Dilution: For example, in vaccines, there is herd immunity. That means other people getting the vaccines also improves my health outcomes.</li>
</ul>
</div>
</div>
</div>
<p>If we know the two hypothetical parallel worlds are identical to each other <u>except</u> for treatment <span class="math inline">\(D_i\)</span>, then we know any difference in <span class="math inline">\(Y\)</span> outcomes between the two worlds must be a result of treatment <span class="math inline">\(D\)</span>. This difference in potential outcomes is called the individual treatment effect <span class="math inline">\(\tau\)</span>.</p>
<div id="def-ite" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.2 (Individual Treatment Effect)</strong></span> The individual treatment effect of treatment <span class="math inline">\(D\)</span> on <span class="math inline">\(Y\)</span>, for a specific unit <span class="math inline">\(i\)</span>, is given by the difference between the potential outcomes.</p>
<p><span class="math display">\[
\tau_i = Y_{1i} - Y_{0i}
\]</span></p>
</div>
<p><br></p>
<p>However, there is an issue: in the real world, we obviously do not have two hypothetical parallel worlds. We only have one world - either unit <span class="math inline">\(i\)</span> gets treated <span class="math inline">\(D_i = 1\)</span> or unit <span class="math inline">\(i\)</span> does not get treated <span class="math inline">\(D_i = 0\)</span>. The world we actually live in is called the observed outcome, and the parallel world we do not see is called the counterfactual.</p>
<div id="def-observedoutcomes" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.3 (Observed Outcomes and Counterfactuals)</strong></span> The observed outcome <span class="math inline">\(Y_i\)</span> that we actually see for a unit <span class="math inline">\(i\)</span> can be given by a function of potential outcomes:</p>
<p><span class="math display">\[
Y_i = D_i \cdot Y_{1i} + (1-D_i) \cdot Y_{0i}
\]</span></p>
<p>If we plug in the treatment status <span class="math inline">\(D_i = 0, 1\)</span> of unit <span class="math inline">\(i\)</span> into the above equation, we get observed outcomes</p>
<p><span class="math display">\[
Y_i = \begin{cases}
Y_{1i} &amp; \text{if} D_i = 1 \\
Y_{0i} &amp; \text{if} D_i = 0
\end{cases}
\]</span></p>
<p>The potential outcome that is not observed is the counterfactual outcome.</p>
</div>
<p><br></p>
<p>The fact that we cannot observe the two parallel worlds, and that the counterfactual is never observable in our real world, is called the <strong>fundamental problem of causal inference</strong>. Our goal in causal inference will be to somehow approximate/estimate these counterfactuals in order to estimate causal effects.</p>
<p><br></p>
</section>
<section id="causal-estimands" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="causal-estimands"><span class="header-section-number">7.2</span> Causal Estimands</h2>
<p>Earlier, we discussed the individual treatment effect <span class="math inline">\(\tau_i\)</span> from <a href="#def-ite" class="quarto-xref">definition&nbsp;<span>7.2</span></a>. However, because of the fundamental problem of causal inference, we do not know the counterfactuals.</p>
<p>At an individual level, these counterfactuals are almost impossible to estimate, so we typically do not use the individual treatment effect. Instead, we will typically look at the averages of treatment effects. The most common causal estimand (true value in the population) we will use is the average treatment effect.</p>
<div id="def-ate" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.4 (Average Treatment Effect)</strong></span> The ATE is the average individual treatment effects <span class="math inline">\(\tau_i\)</span> in the population.</p>
<p><span class="math display">\[
\tau_{ATE} = \E(\tau_i) \  = \  \E(Y_{1i} - Y_{0i})  \ = \  \E Y_{1i} - \E Y_{0i}
\]</span></p>
</div>
<p><br></p>
<p>Obviously, we do not observe the counterfactual outcomes. However, at a group level, their averages are more easily estimated, which we will explore later in the chapter.</p>
<p>The ATE is not the only causal estimand. We will often consider a few other causal estimands.</p>
<div id="def-att" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.5 (Average Treatment Effect on the Treated)</strong></span> The ATT is the average individual treatment effect <span class="math inline">\(\tau_i\)</span> for only units that were assigned to the treatment group <span class="math inline">\(D_i = 1\)</span>:</p>
<p><span class="math display">\[
\tau_{ATT} = \E(\tau_i | D_i = 1) \ = \ \E(Y_{1i} - Y_{0i} | D_i = 1)
\]</span></p>
</div>
<p><br></p>
<p>The ATT is usually not equal to the ATE, but in specific circumstances, they can be equal.</p>
<p>The opposite estimand also exists - the average treatment effect on the untreated (ATU). This is typically not something we calculate, but it is used in some proofs.</p>
<p>Sometimes, we also might believe there are heterogenous treatment effects - i.e.&nbsp;some third variable strengthens or weakens the strength of an estimand. For example, perhaps a policy has more positive effects on females than males. Thus, we can also find the ATE conditional on some third variable.</p>
<div id="def-cate" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.6 (Conditional Average Treatment Effect)</strong></span> The CATE is the average treatment effect, conditional on some other characteristic/covariate <span class="math inline">\(X\)</span> value:</p>
<p><span class="math display">\[
\tau_{CATE}(x) = \E(\tau_i| X = x) \ = \ \E(Y_{1i} - Y_{0i}|X=x)
\]</span></p>
<p>This estimand is also sometimes called the local average treatment effect (LATE).</p>
</div>
<p><br></p>
<p>These causal estimands are all estimands - true population parameters. Our goal will be to fill in the missing counterfactuals with some <strong>identification</strong> strategy, in order to estimate these true population estimands.</p>
<p><br></p>
</section>
<section id="structural-causal-models" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="structural-causal-models"><span class="header-section-number">7.3</span> Structural Causal Models</h2>
<p><br></p>
</section>
<section id="selection-bias" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="selection-bias"><span class="header-section-number">7.4</span> Selection Bias</h2>
<p>You always here the saying - correlation is not causation. But what does that actually mean? A simple model of correlation <span class="math inline">\(\rho\)</span> is finding how observed <span class="math inline">\(Y\)</span> changes when <span class="math inline">\(D\)</span> changes. More specifically, we want to find the differences in conditional expectations (given by <a href="random.html#def-condexp" class="quarto-xref">definition&nbsp;<span>1.5</span></a>) of observed <span class="math inline">\(Y_i\)</span> values for when <span class="math inline">\(D_i = 1\)</span> and <span class="math inline">\(D_i = 0\)</span>:</p>
<p><span class="math display">\[
\rho_{D, Y} = \E(Y_i|D_i = 1) - \E (Y_i | D_i = 0)
\]</span>Now, let us do some algebra. First, we know that <span class="math inline">\(Y_i|D_i = 1\)</span> is the observed potential outcome <span class="math inline">\(Y_{1i}|D_i = 1\)</span>. We also know that <span class="math inline">\(Y_i|D_i = 0\)</span> is the observed potential outcome <span class="math inline">\(Y_{0i}|D_I = 0\)</span>. Thus, we can rewrite the above to</p>
<p><span class="math display">\[
\rho_{D, Y} = \E(Y_{1i}|D_i = 1) - \E(Y_{0i}|D_i = 0)
\]</span></p>
<p>Now, let us do an algebra trick. We know that adding a zero doesn’t change the equality of the equation. Let us add the term <span class="math inline">\(\E(Y_{0i}|D_i = 1)\)</span>, but then also subtract that term, so we are essentially adding a 0. Then we get</p>
<p><span class="math display">\[
\rho_{D, Y} = \E(Y_{1i}|D_i = 1) - \E(Y_{0i}|D_i = 0) \color{blue}{+ \E(Y_{0i}|D_i = 1)}\color{purple}{ - \E(Y_{0i}|D_i = 1)}
\]</span></p>
<p>Let us rearrange the order of the terms to get</p>
<p><span id="eq-selectionbias"><span class="math display">\[
\rho_{D, Y} = \underbrace{\E(Y_{1i}|D_i = 1) \color{purple}{ - \E(Y_{0i}|D_i = 1)}}_{\tau_{ATT}} \underbrace{\color{blue}{+ \E(Y_{0i}|D_i = 1)} \color{black}- \E(Y_{0i}|D_i = 0)}_{\text{selection bias}}
\tag{7.1}\]</span></span></p>
<p>We can see that according to <a href="#def-att" class="quarto-xref">definition&nbsp;<span>7.5</span></a>, the first part of this correlation between <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span> is the ATT, one of the causal estimands. However, the correlation <span class="math inline">\(\rho_{D,Y}\)</span> does not only equal the <span class="math inline">\(\tau_{ATT}\)</span>, as there is an extra bit, the <em>selection bias</em>. If this selection bias is not 0, then our correlation is clearly not equal to our ATT.</p>
<p>Let us look at the selection bias term more carefully:</p>
<p><span class="math display">\[
\underbrace{\color{blue}{+ \E(Y_{0i}|D_i = 1)} \color{black}- \E(Y_{0i}|D_i = 0)}_{\text{selection bias}}
\]</span></p>
<p>The blue part is the average potential outcome under parallel world <span class="math inline">\(D_i = 0\)</span> for the units that were assigned to treatment <span class="math inline">\(D_i = 1\)</span>. The black part is the average potential outcome under parallel world <span class="math inline">\(D_i = 0\)</span> for units that were assigned to control <span class="math inline">\(D_i = 0\)</span>.</p>
<p>If this term is non-zero, that means the control group and treatment group have different average <span class="math inline">\(Y_{0i}\)</span> values. That means, before our experiment had even started, the control and treatment groups had different baseline potential outcome <span class="math inline">\(Y_{0i}\)</span>. If for example, the treatment group <span class="math inline">\(D_i = 1\)</span> initially had a very low <span class="math inline">\(Y_{0i}\)</span>, even after treatment with true effect <span class="math inline">\(+\tau\)</span>, their outcome <span class="math inline">\(Y_i\)</span> may still be lower than people who didn’t get the treatment. So, our correlation <span class="math inline">\(\rho_{D,Y}\)</span> would pick up a negative treatment effect, when the actual treatment effect is positive <span class="math inline">\(+\tau\)</span>.</p>
<p>hospital example</p>
<p><br></p>
</section>
<section id="confounders" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="confounders"><span class="header-section-number">7.5</span> Confounders</h2>
<p>The reason for this difference in pre-experiment <span class="math inline">\(Y_{0i}\)</span> is a third variable <span class="math inline">\(X\)</span> is causing people to go to select treatment <span class="math inline">\(D\)</span> more frequently, and also has some effect on <span class="math inline">\(Y\)</span>. <span class="math inline">\(X\)</span> is thus causing <strong>selection bias</strong>. An <span class="math inline">\(X\)</span> that causes selection bias is called a confounder.</p>
<div id="def-confounder" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.7 (Confounder)</strong></span> A confounder is a third variable <span class="math inline">\(X\)</span> that causes selection into treatment <span class="math inline">\(D\)</span> and causes changes in outcome <span class="math inline">\(Y\)</span>. If there is such a variable, this creates selection bias, and makes correlation not equal causation.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-2044932443.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:35.0%"></p>
</figure>
</div>
<p>For example, the figure above, <span class="math inline">\(X\)</span> is confounding the relationship between <span class="math inline">\(D \rightarrow Y\)</span>. This is because both <span class="math inline">\(X\)</span> is correlated with <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span>. When we naively estimated the correlation <span class="math inline">\(\rho_{D,Y}\)</span>, we are estimating the relationship between <span class="math inline">\(D \rightarrow Y\)</span> <u>and</u> the relationship <span class="math inline">\(D \leftarrow X \rightarrow Y\)</span> . But, the true causal effect is <span class="math inline">\(D \rightarrow Y\)</span>, without the other backdoor path. For accurate causal estimation, we need some way to “block” the path through <span class="math inline">\(X\)</span>.</p>
<p>Why isn’t <span class="math inline">\(V\)</span> a confounder? Well, <span class="math inline">\(V\)</span> does not cause selection into <span class="math inline">\(D\)</span>, as the arrow direction shows that <span class="math inline">\(D\)</span> causes <span class="math inline">\(V\)</span>. Thus, <span class="math inline">\(V\)</span> is not causing selection bias. We do not care about variables caused by <span class="math inline">\(D\)</span>.</p>
<p><br></p>
</section>
<section id="randomisation" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="randomisation"><span class="header-section-number">7.6</span> Randomisation</h2>
<p>One way we can eliminate selection bias is through randomly assigning our subjects to either treatment <span class="math inline">\(D_i = 1\)</span> or control <span class="math inline">\(D_i = 0\)</span>. Since we are determining (through randomisation) who gets <span class="math inline">\(D\)</span>, that means confounder <span class="math inline">\(X\)</span> is no longer determining who gets <span class="math inline">\(D\)</span>. This breaks the relationship between <span class="math inline">\(X \rightarrow D\)</span>, eliminating the backdoor path and selection bias.</p>
<p>Randomisation implies that the assignment probabilities do not depend on the potential outcomes - the values of <span class="math inline">\(Y_{0i}\)</span> and <span class="math inline">\(Y_{1i}\)</span> do not affect the probability of a unit <span class="math inline">\(i\)</span> getting put into treatment <span class="math inline">\(D_i = 1\)</span> or control <span class="math inline">\(D_i = 0\)</span>.</p>
<p><span class="math display">\[
\P(D_i = 1 | Y_{0i}, Y_{1i}) \ = \ \P(D_i = 1)
\]</span></p>
<p>This fact implies the critical assumption of randomisation, independence.</p>
<div id="def-randomisation" class="theorem definition" style="border-style: solid; border-radius: 8px; border-width: 0.5px; padding-top: 5px;   padding-right: 5px; padding-bottom: 5px; padding-left: 5px;">
<p><span class="theorem-title"><strong>Definition 7.8 (Independence)</strong></span> Randomisation, if done properly, implies independence. Independence, also called unconfoundedness or ignorability, is the statement that potential outcomes are independent of treatment:</p>
<p><span class="math display">\[
(Y_{1i}, Y_{0i}) \ind D_i
\]</span></p>
<p>This assumption, and the defintition of independence from <a href="random.html#def-independence" class="quarto-xref">definition&nbsp;<span>1.4</span></a>, implies that <span class="math inline">\(\E Y_{0i}\)</span> and <span class="math inline">\(\E Y_{1i}\)</span> are equal between treatment and control:</p>
<p><span class="math display">\[
\begin{align}
&amp; \E(Y_{0i}|D_i = 1) \ = \ \E(Y_{0i}|D_i = 0) \ = \ \E Y_{0i} \\
&amp; \E(Y_{1i}|D_i = 1) \ = \ \E(Y_{1i}|D_i = 0) \ = \ \E Y_{1i}
\end{align}
\]</span></p>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checking if Independence is Met
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>When we are writing a paper, we might want to convince our readers that randomisation has indeed successfully been implemented, and that the assumption of independence has been met. The most common way to check this is with a <strong>balance</strong> check. We essentially consider a few likely confounders <span class="math inline">\(X\)</span>. We then run a regression:</p>
<p><span class="math display">\[
X_i = \beta_0 + \beta_1 D_i + \eps_i
\]</span></p>
<p><span class="math inline">\(\beta_1\)</span> will show the difference between <span class="math inline">\(\E(X_i | D_i = 1)\)</span> and <span class="math inline">\(\E(X_i|D_i = 0)\)</span>. If <span class="math inline">\(\beta_1\)</span> is not statistically significantly different, then we can conclude the treatment and control groups are similar, and that randomisation has suceeded.</p>
<p>Do note that the important thing in randomisation (and the assumption of independence) is not that <span class="math inline">\(X_i\)</span> is random between treatment and control, but rather potential outcomes are random. Although, if <span class="math inline">\(X_i\)</span> is random between treatment and control, that generally implies potential outcomes are also random.</p>
</div>
</div>
</div>
<p>We can prove that randomisation and the independence assumption allow us to eliminate the selection bias shown in <a href="#eq-selectionbias" class="quarto-xref">eq.&nbsp;<span>7.1</span></a>. Let us start with our correlation from <a href="#eq-selectionbias" class="quarto-xref">eq.&nbsp;<span>7.1</span></a>:</p>
<p><span class="math display">\[
\rho_{D, Y} = \underbrace{\E(Y_{1i}|D_i = 1)- \E(Y_{0i}|D_i = 1)}_{\tau_{ATT}} + \underbrace{\E(Y_{0i}|D_i = 1) - \E(Y_{0i}|D_i = 0)}_{\text{selection bias}}
\]</span></p>
<p>Using the properties of independence from <a href="#def-randomisation" class="quarto-xref">definition&nbsp;<span>7.8</span></a>, we can get</p>
<p><span class="math display">\[
\begin{align}
\rho_{D, Y} &amp; = \underbrace{\E(Y_{1i}|D_i = 1)- \E(Y_{0i}|D_i = 1)}_{\tau_{ATT}} + \underbrace{\E Y_{0i} - \E Y_{0i}}_{\text{selection bias}} \\
&amp; = \underbrace{\E(Y_{1i}|D_i = 1)- \E(Y_{0i}|D_i = 1)}_{\tau_{ATT}} + 0
\end{align}
\]</span></p>
<p>Thus, we can see the assumption of independence has removed our selection bias, and allowed us to accurately calculate our <span class="math inline">\(\tau_{ATT}\)</span> simply by looking at the correlation <span class="math inline">\(\rho_{D,Y}\)</span>.</p>
<p>We can also identify the ATE from our correlation <span class="math inline">\(\rho_{D,Y}\)</span>, by simplifying once again using the properties implied by the assumption of independence from <a href="#def-randomisation" class="quarto-xref">definition&nbsp;<span>7.8</span></a>:</p>
<p><span class="math display">\[
\begin{align}
\rho_{D, Y} &amp; = \underbrace{\E(Y_{1i}|D_i = 1)- \E(Y_{0i}|D_i = 1)}_{\tau_{ATT}} \\
&amp; = \underbrace{\E Y_{1i} - \E Y_{0i}}_{\tau_{ATE}}
\end{align}
\]</span></p>
<p>Which according to <a href="#def-ate" class="quarto-xref">definition&nbsp;<span>7.4</span></a>, is the ATE. Thus, under randomisation, our correlation measure <span class="math inline">\(\rho_{D,Y}\)</span> properly identifies/measures both the ATT and ATE, and the ATT and ATE are equivalent under randomisation. Thus, we can estimate the ATE in a randomisation setting where independence is met simply with a correlation measure, such as a linear model:</p>
<p><span class="math display">\[
Y_i = \alpha + \tau D_i + \eps_i
\]</span></p>
<p>Where <span class="math inline">\(\tau\)</span> can be estimated with OLS, GLS, or MLE (although OLS with robust standard errors is generally the preferred estimator).</p>
<p><br></p>
</section>
<section id="randomised-experiments" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="randomised-experiments"><span class="header-section-number">7.7</span> Randomised Experiments</h2>
<p><br></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./mom.html" class="pagination-link" aria-label="Method of Moments">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Method of Moments</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./soo.html" class="pagination-link" aria-label="Selection on Observables">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Selection on Observables</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>